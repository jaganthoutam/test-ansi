---
  - name: Playbook
    hosts: webserver
    become: yes
    become_user: root
    tasks:
      - name: Check if Service Exists
        stat: path=/etc/init.d/httpd
        register: service_status
        
      - name: Stop httpd graceful
        command: httpd -k graceful-stop
        when: service_status.stat.exists

      - name: Stop Service
        service: name=httpd state=stopped
        when: service_status.stat.exists
        
      - name: ensure apache is at the latest version
        yum:
          name: httpd
          state: latest
      - name: ensure apache is running
        service:
          name: httpd
          state: started
          
      - name: Make sure a service is running
        systemd: state=started name=httpd

      - name: reload service httpd, in all cases
        systemd:
          name: httpd
          state: reloaded

      - name: enable service httpd and ensure it is not masked
        systemd:
          name: httpd
          enabled: yes
          masked: no

      - name: just force systemd to reread configs (2.4 and above)
        systemd: daemon_reload=yes
        
